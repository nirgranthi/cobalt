import{v as y}from"./cobalt/DWm3Adpf.js";import b from"./cobalt/CLGzANJa.js";import{s as m}from"./cobalt/Hp68DFFA.js";import g from"./cobalt/BoOYR1ng.js";import{F as r}from"./cobalt/CRlX8TpR.js";import{t as a}from"./cobalt/sLrbt0Jw.js";import{d as u}from"./cobalt/Ddzr_Ig4.js";import{createDialog as p}from"./cobalt/BrKf4TUx.js";import{downloadButtonState as o}from"./cobalt/D71N2tIv.js";import{createSavePipeline as w}from"./cobalt/CuLQTwuK.js";const H=async({url:n,request:l,oldTaskId:v})=>{var c;o.set("think");const s=i=>p({id:"save-error",type:"small",meowbalt:"error",buttons:[{text:r(a)("button.gotit"),main:!0,action:()=>{}}],bodyText:i}),t=g(r(m));if(!l&&!n)return;const d=l||{url:n,localProcessing:r(m).save.localProcessing,alwaysProxy:t("save","alwaysProxy"),downloadMode:t("save","downloadMode"),subtitleLang:t("save","subtitleLang"),filenameStyle:t("save","filenameStyle"),disableMetadata:t("save","disableMetadata"),audioFormat:t("save","audioFormat"),audioBitrate:t("save","audioBitrate"),tiktokFullAudio:t("save","tiktokFullAudio"),youtubeDubLang:t("save","youtubeDubLang"),youtubeBetterAudio:t("save","youtubeBetterAudio"),videoQuality:t("save","videoQuality"),youtubeVideoCodec:t("save","youtubeVideoCodec"),youtubeVideoContainer:t("save","youtubeVideoContainer"),youtubeHLS:y.ENABLE_DEPRECATED_YOUTUBE_HLS?t("save","youtubeHLS"):void 0,allowH265:t("save","allowH265"),convertGif:t("save","convertGif")},e=await b.request(d);if(!e)return o.set("error"),s(r(a)("error.api.unreachable"));if(e.status==="error")return o.set("error"),s(r(a)(e.error.code,(c=e==null?void 0:e.error)==null?void 0:c.context));if(e.status==="redirect")return o.set("done"),u({url:e.url,urlType:"redirect"});if(e.status==="tunnel")return o.set("check"),await b.probeCobaltTunnel(e.url)===200?(o.set("done"),u({url:e.url})):(o.set("error"),s(r(a)("error.tunnel.probe")));if(e.status==="local-processing")return o.set("done"),w(e,d,v);if(e.status==="picker"){o.set("done");const i=[{text:r(a)("button.done"),main:!0,action:()=>{}}];if(e.audio){const f=e.audio;i.unshift({text:r(a)("button.download.audio"),main:!1,action:()=>{u({url:f})}})}return p({id:"download-picker",type:"picker",items:e.picker,buttons:i})}return o.set("error"),s(r(a)("error.api.unknown_response"))};export{H as savingHandler};
//cobalt/# sourceMappingURL=FFwMLUrV.js.map



